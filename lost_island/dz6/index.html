<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Geometry Calculator</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        a-scene {
            width: 100%;
            height: 100%;
            display: block;
        }
    </style>
</head>
<body>
    <a-scene mindar-image="imageTargetSrc: https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.0/examples/image-tracking/assets/card-example/card.mind; autoStart: true; uiLoading: no; uiScanning: no; uiError: no;" 
             vr-mode-ui="enabled: false"
             renderer="colorManagement: true;">

        <!-- Маркери -->
        <a-entity mindar-image-target="targetIndex: 0" id="markerA">
            <a-sphere color="red" radius="0.1"></a-sphere>
            <a-text value="A" color="white" align="center" position="0 0.2 0"></a-text>
            <a-entity id="lineAB"></a-entity>
            <a-entity id="lineAC"></a-entity>
            <a-entity id="lineAD"></a-entity>
            <a-text id="results" value="" position="0 0.3 0" rotation="-90 0 0" color="yellow"></a-text>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 1" id="markerB">
            <a-sphere color="blue" radius="0.1"></a-sphere>
            <a-text value="B" color="white" align="center" position="0 0.2 0"></a-text>
            <a-entity id="lineBC"></a-entity>
            <a-entity id="lineBD"></a-entity>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 2" id="markerC">
            <a-sphere color="green" radius="0.1"></a-sphere>
            <a-text value="C" color="white" align="center" position="0 0.2 0"></a-text>
            <a-entity id="lineCD"></a-entity>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 3" id="markerD">
            <a-sphere color="yellow" radius="0.1"></a-sphere>
            <a-text value="D" color="white" align="center" position="0 0.2 0"></a-text>
        </a-entity>

        <!-- Камера -->
        <a-entity camera position="0 0 0" look-controls="enabled: false"></a-entity>
    </a-scene>

    <!-- Підключаємо бібліотеки в кінці body -->
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    
    <script>
        // Чекаємо повного завантаження сторінки
        window.addEventListener('load', function() {
            // Чекаємо ініціалізації A-Frame
            const scene = document.querySelector('a-scene');
            
            scene.addEventListener('loaded', function() {
                console.log('A-Frame сцена завантажена');
                
                // Ініціалізація змінних
                const markers = {
                    A: null,
                    B: null,
                    C: null,
                    D: null
                };
                
                const distances = {
                    AB: 0, BC: 0, CD: 0, DA: 0,
                    AC: 0, BD: 0
                };
                
                // Створюємо лінії між маркерами
                function createLine(elementId) {
                    const line = document.getElementById(elementId);
                    const geometry = new THREE.CylinderGeometry(0.02, 0.02, 1, 8);
                    const material = new THREE.MeshBasicMaterial({color: 0xffffff});
                    const mesh = new THREE.Mesh(geometry, material);
                    
                    mesh.rotation.x = Math.PI / 2; // Горизонтальне положення
                    line.object3D.add(mesh);
                    mesh.visible = false;
                    
                    return mesh;
                }
                
                // Створюємо всі лінії
                const lineAB = createLine('lineAB');
                const lineAC = createLine('lineAC');
                const lineAD = createLine('lineAD');
                const lineBC = createLine('lineBC');
                const lineBD = createLine('lineBD');
                const lineCD = createLine('lineCD');
                
                // Оновлюємо положення ліній
                function updateLine(line, startMarker, endMarker) {
                    if (!markers[startMarker] || !markers[endMarker]) {
                        line.visible = false;
                        return;
                    }
                    
                    const start = markers[startMarker];
                    const end = markers[endMarker];
                    
                    // Розраховуємо відстань між точками
                    const distance = start.distanceTo(end);
                    
                    // Позиціонуємо лінію
                    line.position.x = (start.x + end.x) / 2;
                    line.position.y = (start.y + end.y) / 2;
                    line.position.z = (start.z + end.z) / 2;
                    
                    // Повертаємо лінію у напрямку до кінцевої точки
                    line.lookAt(end);
                    
                    // Масштабуємо за довжиною
                    line.scale.z = distance;
                    line.visible = true;
                    
                    // Зберігаємо відстань
                    distances[startMarker + endMarker] = distance;
                    distances[endMarker + startMarker] = distance;
                }
                
                // Функція для розрахунку площі трикутника
                function calculateTriangleArea(a, b, c) {
                    const p = (a + b + c) / 2;
                    return Math.sqrt(p * (p - a) * (p - b) * (p - c));
                }
                
                // Оновлюємо всі лінії та розрахунки
                function updateAll() {
                    updateLine(lineAB, 'A', 'B');
                    updateLine(lineAC, 'A', 'C');
                    updateLine(lineAD, 'A', 'D');
                    updateLine(lineBC, 'B', 'C');
                    updateLine(lineBD, 'B', 'D');
                    updateLine(lineCD, 'C', 'D');
                    
                    // Якщо всі маркери видимі
                    if (markers.A && markers.B && markers.C && markers.D) {
                        // Розраховуємо периметр
                        const perimeter = distances.AB + distances.BC + distances.CD + distances.DA;
                        
                        // Розраховуємо площі трикутників
                        const areaABC = calculateTriangleArea(distances.AB, distances.BC, distances.AC);
                        const areaABD = calculateTriangleArea(distances.AB, distances.BD, distances.AD);
                        const areaACD = calculateTriangleArea(distances.AC, distances.CD, distances.AD);
                        const areaBCD = calculateTriangleArea(distances.BC, distances.CD, distances.BD);
                        
                        // Оновлюємо текст з результатами
                        const resultsText = document.getElementById('results');
                        resultsText.setAttribute('value', 
                            `Периметр: ${perimeter.toFixed(2)}\n` +
                            `Площі трикутників:\n` +
                            `ABC: ${areaABC.toFixed(2)}\n` +
                            `ABD: ${areaABD.toFixed(2)}\n` +
                            `ACD: ${areaACD.toFixed(2)}\n` +
                            `BCD: ${areaBCD.toFixed(2)}`
                        );
                    }
                }
                
                // Обробка подій маркерів
                ['A', 'B', 'C', 'D'].forEach((markerId) => {
                    const marker = document.getElementById(`marker${markerId}`);
                    
                    marker.addEventListener('targetFound', () => {
                        markers[markerId] = marker.object3D.position.clone();
                        updateAll();
                    });
                    
                    marker.addEventListener('targetLost', () => {
                        markers[markerId] = null;
                        updateAll();
                    });
                });
                
                // Періодичне оновлення
                setInterval(updateAll, 100);
            });
        });
    </script>
</body>
</html>
