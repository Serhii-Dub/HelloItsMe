<!DOCTYPE html>
<html>
  <head>
    <title>Чотирикутник AR</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@3.3.2/aframe/build/aframe-ar.min.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
      <!-- Камера -->
      <a-entity camera></a-entity>

      <!-- Маркери -->
      <a-marker id="markerA" type="pattern" url="pattern-A.patt">
        <a-sphere radius="0.05" color="red" position="0 0 0"></a-sphere>
      </a-marker>

      <a-marker id="markerB" type="pattern" url="pattern-B.patt">
        <a-sphere radius="0.05" color="green" position="0 0 0"></a-sphere>
      </a-marker>

      <a-marker id="markerC" type="pattern" url="pattern-C.patt">
        <a-sphere radius="0.05" color="blue" position="0 0 0"></a-sphere>
      </a-marker>

      <a-marker id="markerD" type="pattern" url="pattern-D.patt">
        <a-sphere radius="0.05" color="yellow" position="0 0 0"></a-sphere>
      </a-marker>

      <a-entity id="text-info" position="0 0 0" text="value: Зачекайте...; color: black; width: 4;"></a-entity>
    </a-scene>

<script>
  window.addEventListener("DOMContentLoaded", () => {
    const markerA = document.querySelector("#markerA");
    const markerB = document.querySelector("#markerB");
    const markerC = document.querySelector("#markerC");
    const markerD = document.querySelector("#markerD");
    const infoText = document.querySelector("#text-info");

    function getWorldPosition(marker) {
      const position = new THREE.Vector3();
      marker.object3D.getWorldPosition(position);
      return position;
    }

    function distance(p1, p2) {
      return p1.distanceTo(p2);
    }

    function triangleArea(a, b, c) {
      const ab = distance(a, b);
      const bc = distance(b, c);
      const ca = distance(c, a);
      const s = (ab + bc + ca) / 2;
      return Math.sqrt(s * (s - ab) * (s - bc) * (s - ca));
    }

    function updateCalculations() {
      if (
        markerA.object3D.visible &&
        markerB.object3D.visible &&
        markerC.object3D.visible &&
        markerD.object3D.visible
      ) {
        const A = getWorldPosition(markerA);
        const B = getWorldPosition(markerB);
        const C = getWorldPosition(markerC);
        const D = getWorldPosition(markerD);

        const perim =
          distance(A, B) +
          distance(B, C) +
          distance(C, D) +
          distance(D, A);

        const areaABC = triangleArea(A, B, C);
        const areaBCD = triangleArea(B, C, D);
        const areaCDA = triangleArea(C, D, A);
        const areaDAB = triangleArea(D, A, B);

        const message = `Периметр: ${perim.toFixed(2)} м\n` +
          `Площа ∆ABC: ${areaABC.toFixed(4)} м²\n` +
          `Площа ∆BCD: ${areaBCD.toFixed(4)} м²\n` +
          `Площа ∆CDA: ${areaCDA.toFixed(4)} м²\n` +
          `Площа ∆DAB: ${areaDAB.toFixed(4)} м²`;

        infoText.setAttribute("text", "value", message);
      } else {
        infoText.setAttribute("text", "value", "Очікуємо всі 4 маркери...");
      }
    }

    setInterval(updateCalculations, 1000);
  });
</script>

  </body>
</html>
