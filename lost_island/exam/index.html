<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–¥ —Å—Ç–∞—î —Ä–µ–∞–ª—å–Ω—ñ—Å—Ç—é | AR-–≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–≥—Ä–∞–º</title>
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>
    <div class="container">
        <h1>üîç –ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥ –∑ –∫–æ–¥–æ–º –ø—Ä–æ–≥—Ä–∞–º–∏</h1>
        <div id="ar-container"></div>
        <div id="code-visualization">
            <pre id="code-display"></pre>
            <div id="variables-panel"></div>
            <div id="call-stack"></div>
        </div>
    </div>

    <!-- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ CDN-–ø–æ—Å–∏–ª–∞–Ω–Ω—è -->
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.1/dist/mindar-image-three.prod.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>
        // –ß–µ–∫–∞—î–º–æ –ø–æ–≤–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫
        window.addEventListener('load', async () => {
            try {
                const { MindARThree } = window.MINDAR.IMAGE;
                const mindar = new MindARThree({
                    container: document.getElementById("ar-container"),
                    imageTargetSrc: "lib/targets.mind",
                });

                const { renderer, scene, camera } = mindar;

                // –î–æ–¥–∞—î–º–æ —Å–≤—ñ—Ç–ª–æ –¥–ª—è –∫—Ä–∞—â–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
                const light = new THREE.DirectionalLight(0xffffff, 1);
                light.position.set(0, 0, 1);
                scene.add(light);

                mindar.onTargetFound = (targetIdx) => {
                    console.log("–ú–∞—Ä–∫–µ—Ä –∑–Ω–∞–π–¥–µ–Ω–æ:", targetIdx);
                    const programCode = getProgramCode(targetIdx);
                    visualizeCodeExecution(programCode);
                };

                await mindar.start();
                renderer.setAnimationLoop(() => {
                    renderer.render(scene, camera);
                });

                function getProgramCode(markerId) {
                    const programs = [
                        `// –ü—Ä–æ–≥—Ä–∞–º–∞ 1: –°—É–º–∞ —á–∏—Å–µ–ª\nlet sum = 0;\nfor (let i = 1; i <= 10; i++) {\n    sum += i;\n}\nconsole.log(sum);`,
                        `// –ü—Ä–æ–≥—Ä–∞–º–∞ 2: –§–∞–∫—Ç–æ—Ä—ñ–∞–ª\nfunction factorial(n) {\n    if (n <= 1) return 1;\n    return n * factorial(n - 1);\n}\nfactorial(5);`
                    ];
                    return programs[markerId] || "// –ö–æ–¥ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ";
                }

                function visualizeCodeExecution(code) {
                    const lines = code.split('\n');
                    let lineIdx = 0;
                    const interval = setInterval(() => {
                        if (lineIdx >= lines.length) {
                            clearInterval(interval);
                            optimizeCode(code);
                            return;
                        }
                        highlightLine(lineIdx, lines);
                        lineIdx++;
                    }, 1000);
                }

                function highlightLine(lineNumber, lines) {
                    const codeDisplay = document.getElementById("code-display");
                    codeDisplay.innerHTML = lines.map((line, idx) => {
                        return `<div class="${idx === lineNumber ? 'highlight-line' : ''}">${line}</div>`;
                    }).join('\n');
                }

                function optimizeCode(code) {
                    console.log("[ML] –ê–Ω–∞–ª—ñ–∑ –∫–æ–¥—É...");
                    const warnings = [];
                    if (code.includes("for(let i=0")) {
                        warnings.push("üîç –ó–∞–º—ñ–Ω—ñ—Ç—å 'for' –Ω–∞ 'forEach' –∞–±–æ 'map' –¥–ª—è –º–∞—Å–∏–≤—ñ–≤");
                    }
                    if (code.includes("==")) {
                        warnings.push("üîç –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ '===' –∑–∞–º—ñ—Å—Ç—å '==' –¥–ª—è —Å—Ç—Ä–æ–≥–æ–≥–æ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è");
                    }

                    const mlResults = document.createElement("div");
                    mlResults.innerHTML = `<h3>ü§ñ –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π–Ω—ñ –ø–æ—Ä–∞–¥–∏:</h3><ul>${
                        warnings.map(w => `<li>${w}</li>`).join("")
                    }</ul>`;
                    document.getElementById("variables-panel").appendChild(mlResults);
                }

            } catch (error) {
                console.error("–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó:", error);
                alert("–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ AR. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.");
            }
        });
    </script>
</body>
</html>