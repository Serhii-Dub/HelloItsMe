<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Educational Project</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/mind-ar/dist/mindar-image-three.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        #container { position: relative; width: 100%; height: 100vh; overflow: hidden; }
        #ui-panel { 
            position: absolute; top: 10px; left: 10px; z-index: 100;
            background: rgba(0,0,0,0.7); color: white; padding: 10px;
            border-radius: 5px; max-width: 300px;
        }
        #loading { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 200; background: white; padding: 20px; border-radius: 10px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="loading">
            <h3>Завантаження AR додатку...</h3>
            <p>Наведіть камеру на маркер</p>
        </div>
        
        <div id="ui-panel">
            <h4 id="title">AR Educational Experience</h4>
            <div id="info">Знайдіть маркер для початку</div>
            <div id="controls"></div>
        </div>
    </div>

    <script type="module">
        const THREE = window.MINDAR.IMAGE.THREE;
        
        // ML Model for Computer Science students
        let mlModel = null;
        
        async function loadMLModel() {
            try {
                // Example: Load emotion detection model
                // mlModel = await tf.loadLayersModel('path/to/model.json');
                console.log('ML Model loaded');
            } catch (error) {
                console.log('ML Model not available');
            }
        }
        
        // AR Application Class
        class AREducationalApp {
            constructor() {
                this.mindarThree = null;
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.isStarted = false;
            }
            
            async init() {
                // Initialize MindAR
                this.mindarThree = new window.MINDAR.IMAGE.MindARThree({
                    container: document.getElementById('container'),
                    imageTargetSrc: './assets/targets.mind', // Your compiled markers
                });
                
                const { renderer, scene, camera } = this.mindarThree;
                this.renderer = renderer;
                this.scene = scene;
                this.camera = camera;
                
                // Add lighting
                const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
                scene.add(light);
                
                // Setup educational content
                await this.setupEducationalContent();
                
                // Setup ML functionality for CS students
                if (mlModel) {
                    this.setupMLFeatures();
                }
                
                // Start AR
                await this.mindarThree.start();
                document.getElementById('loading').style.display = 'none';
                this.isStarted = true;
                
                // Animation loop
                this.renderer.setAnimationLoop(() => {
                    this.update();
                    this.renderer.render(this.scene, this.camera);
                });
            }
            
            async setupEducationalContent() {
                // Create anchors for each marker
                const anchor0 = this.mindarThree.addAnchor(0);
                
                // Example: Add 3D educational content
                const geometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
                const material = new THREE.MeshLambertMaterial({ color: 0x00ff00 });
                const cube = new THREE.Mesh(geometry, material);
                
                anchor0.group.add(cube);
                
                // Add interactivity
                anchor0.onTargetFound = () => {
                    document.getElementById('info').innerHTML = 'Маркер знайдено! Досліджуйте об\'єкт.';
                    this.onMarkerFound(0);
                };
                
                anchor0.onTargetLost = () => {
                    document.getElementById('info').innerHTML = 'Знайдіть маркер для продовження.';
                    this.onMarkerLost(0);
                };
            }
            
            setupMLFeatures() {
                // Implement ML features for CS students
                // Example: Emotion detection, gesture recognition, etc.
                setInterval(() => {
                    if (this.isStarted && mlModel) {
                        this.processMLData();
                    }
                }, 1000);
            }
            
            processMLData() {
                // Process ML data here
                // Example: Analyze user emotions, gestures, etc.
            }
            
            onMarkerFound(markerIndex) {
                // Handle marker found events
                console.log(`Marker ${markerIndex} found`);
            }
            
            onMarkerLost(markerIndex) {
                // Handle marker lost events
                console.log(`Marker ${markerIndex} lost`);
            }
            
            update() {
                // Update educational content
                // Animation, calculations, ML processing
            }
        }
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', async () => {
            await loadMLModel();
            const app = new AREducationalApp();
            await app.init();
        });
    </script>
</body>
</html>