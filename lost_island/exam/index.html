<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–¥ —Å—Ç–∞—î —Ä–µ–∞–ª—å–Ω—ñ—Å—Ç—é | AR-–≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–≥—Ä–∞–º</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- –ü—Ä–∞–≤–∏–ª—å–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫ -->
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.1/dist/mindar-image.prod.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.1/dist/mindar-image-three.prod.js"></script>
</head>
<body>
    <div class="container">
        <h1>üîç –ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥ –∑ –∫–æ–¥–æ–º –ø—Ä–æ–≥—Ä–∞–º–∏</h1>
        <div id="ar-container"></div>
        <div id="code-visualization">
            <pre id="code-display"></pre>
            <div id="variables-panel"></div>
            <div id="call-stack"></div>
        </div>
    </div>

    <script>
        // –ß–µ–∫–∞—î–º–æ –ø–æ–≤–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å API
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error("AR –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è —É –≤–∞—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ");
                }

                // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è MindAR
                const mindar = new window.MINDAR.IMAGE.MindARThree({
                    container: document.getElementById("ar-container"),
                    imageTargetSrc: "lib/targets.mind",
                });

                const { renderer, scene, camera } = mindar;

                // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å—Ü–µ–Ω–∏
                const light = new THREE.DirectionalLight(0xffffff, 1);
                light.position.set(0, 0, 1);
                scene.add(light);

                // –û–±—Ä–æ–±–Ω–∏–∫ –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä–∞
                mindar.onTargetFound = (targetIdx) => {
                    console.log("–ó–Ω–∞–π–¥–µ–Ω–æ –º–∞—Ä–∫–µ—Ä #", targetIdx);
                    const programCode = getProgramCode(targetIdx);
                    visualizeCodeExecution(programCode);
                };

                // –ó–∞–ø—É—Å–∫ AR
                await mindar.start();
                renderer.setAnimationLoop(() => {
                    renderer.render(scene, camera);
                });

                // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –∫–æ–¥–æ–º
                function getProgramCode(markerId) {
                    const programs = [
                        `// –ü—Ä–æ–≥—Ä–∞–º–∞ 1: –°—É–º–∞ —á–∏—Å–µ–ª\nlet sum = 0;\nfor (let i = 1; i <= 10; i++) {\n    sum += i;\n}\nconsole.log(sum);`,
                        `// –ü—Ä–æ–≥—Ä–∞–º–∞ 2: –§–∞–∫—Ç–æ—Ä—ñ–∞–ª\nfunction factorial(n) {\n    if (n <= 1) return 1;\n    return n * factorial(n - 1);\n}\nfactorial(5);`
                    ];
                    return programs[markerId] || "// –ö–æ–¥ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ";
                }

                function visualizeCodeExecution(code) {
                    const lines = code.split('\n');
                    let lineIdx = 0;
                    
                    const interval = setInterval(() => {
                        if (lineIdx >= lines.length) {
                            clearInterval(interval);
                            optimizeCode(code);
                            return;
                        }
                        highlightLine(lineIdx, lines);
                        lineIdx++;
                    }, 1000);
                }

                function highlightLine(lineNumber, lines) {
                    const codeDisplay = document.getElementById("code-display");
                    codeDisplay.innerHTML = lines.map((line, idx) => {
                        return `<div class="${idx === lineNumber ? 'highlight-line' : ''}">${line}</div>`;
                    }).join('\n');
                }

                function optimizeCode(code) {
                    const warnings = [];
                    if (code.includes("for(let i=0")) {
                        warnings.push("üîç –ó–∞–º—ñ–Ω—ñ—Ç—å 'for' –Ω–∞ 'forEach' –∞–±–æ 'map' –¥–ª—è –º–∞—Å–∏–≤—ñ–≤");
                    }
                    if (code.includes("==")) {
                        warnings.push("üîç –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ '===' –∑–∞–º—ñ—Å—Ç—å '==' –¥–ª—è —Å—Ç—Ä–æ–≥–æ–≥–æ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è");
                    }

                    const panel = document.getElementById("variables-panel");
                    panel.innerHTML = `<h3>ü§ñ –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π–Ω—ñ –ø–æ—Ä–∞–¥–∏:</h3><ul>${
                        warnings.map(w => `<li>${w}</li>`).join("")
                    }</ul>`;
                }

            } catch (error) {
                console.error("AR –ø–æ–º–∏–ª–∫–∞:", error);
                document.getElementById("ar-container").innerHTML = `
                    <div class="error">
                        <h3>üö® –ü–æ–º–∏–ª–∫–∞ AR</h3>
                        <p>${error.message}</p>
                        <p>–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ:</p>
                        <ul>
                            <li>–í–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ HTTPS –∞–±–æ –ª–æ–∫–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä</li>
                            <li>–í–∞—à –±—Ä–∞—É–∑–µ—Ä –ø—ñ–¥—Ç—Ä–∏–º—É—î WebGL (Chrome/Firefox)</li>
                            <li>–§–∞–π–ª targets.mind —ñ—Å–Ω—É—î –≤ –ø–∞–ø—Ü—ñ lib/</li>
                        </ul>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>