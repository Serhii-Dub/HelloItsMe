<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Educational Project</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Підключаємо MindAR як модуль -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/mind-ar/dist/mindar-image-three.prod.js"></script>
    <!-- Підключаємо TensorFlow для ML -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
    <!-- Підключаємо файл для оптимізації (ML) -->
    <script type="module" src="ml/optimize.js"></script>
    <!-- Інші бібліотеки -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/geometries/TextGeometry.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/FontLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        #container { position: relative; width: 100%; height: 100vh; overflow: hidden; }
        #ui-panel { 
            position: absolute; top: 10px; left: 10px; z-index: 100;
            background: rgba(0,0,0,0.7); color: white; padding: 10px;
            border-radius: 5px; max-width: 300px;
        }
        #loading { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 200; background: white; padding: 20px; border-radius: 10px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="loading">
            <h3>Завантаження AR додатку...</h3>
            <p>Наведіть камеру на маркер</p>
        </div>
        
        <div id="ui-panel">
            <h4 id="title">AR Educational Experience</h4>
            <div id="info">Знайдіть маркер для початку</div>
            <div id="controls"></div>
        </div>
    </div>

    <script type="module">
        import { MindARThree } from 'https://cdn.jsdelivr.net/npm/mind-ar@1.2.1/dist/mindar-image-three.prod.js';
        import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.module.js';

        let mlModel = null;
        
        async function loadMLModel() {
            try {
                // Завантажуємо модель ML, якщо вона є
                console.log('ML Model loaded');
            } catch (error) {
                console.log('ML Model not available');
            }
        }

        class AREducationalApp {
            constructor() {
                this.mindarThree = null;
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.isStarted = false;
            }

            async init() {
                this.mindarThree = new MindARThree({
                    container: document.getElementById('container'),
                    imageTargetSrc: 'targets.mind', // Шлях до маркерів
                });

                const { renderer, scene, camera } = this.mindarThree;
                this.renderer = renderer;
                this.scene = scene;
                this.camera = camera;
                
                // Додаємо освітлення
                const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
                scene.add(light);
                
                // Налаштовуємо освітній контент
                await this.setupEducationalContent();

                // Якщо є ML модель, то налаштовуємо її
                if (mlModel) {
                    this.setupMLFeatures();
                }

                // Запуск AR
                await this.mindarThree.start();
                document.getElementById('loading').style.display = 'none';
                this.isStarted = true;

                // Анімаційний цикл
                this.renderer.setAnimationLoop(() => {
                    this.update();
                    this.renderer.render(this.scene, this.camera);
                });
            }

            async setupEducationalContent() {
                const anchor0 = this.mindarThree.addAnchor(0);
                const geometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
                const material = new THREE.MeshLambertMaterial({ color: 0x00ff00 });
                const cube = new THREE.Mesh(geometry, material);
                anchor0.group.add(cube);

                anchor0.onTargetFound = () => {
                    document.getElementById('info').innerHTML = 'Маркер знайдено! Досліджуйте об\'єкт.';
                };

                anchor0.onTargetLost = () => {
                    document.getElementById('info').innerHTML = 'Знайдіть маркер для продовження.';
                };
            }

            setupMLFeatures() {
                // Увімкнути ML функції, якщо є необхідність
                setInterval(() => {
                    if (this.isStarted && mlModel) {
                        this.processMLData();
                    }
                }, 1000);
            }

            processMLData() {
                // Обробка ML даних, наприклад, аналіз емоцій або жестів
            }

            update() {
                // Оновлення освітнього контенту
            }
        }

        // Ініціалізація додатку
        document.addEventListener('DOMContentLoaded', async () => {
            await loadMLModel();
            const app = new AREducationalApp();
            await app.init();
        });
    </script>
</body>
</html>
